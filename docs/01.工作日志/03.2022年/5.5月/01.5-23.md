---
title: 5-23
date: 2022-05-23 09:59:35
permalink: /pages/c3ff57/
categories:
  - 工作日志
  - 2022年
  - 5月
tags:
  - 
---
## 今日工作内容
1. 梳理权限现有逻辑和页面功能
2. 数据数据权限三期PRD
3. RWD联调

1、成员列表包含自己
2、成员列表不能邀请自己
3、不能重复邀请



app_auth_user

```SQL
CREATE TABLE `app_auth_user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `user_id` bigint(20) NOT NULL COMMENT '用户Id',
  `app_id` bigint(20) NOT NULL COMMENT 'appID',
  `user_pin` varchar(50) NOT NULL COMMENT '用户pin',
  `user_name` varchar(50) NOT NULL COMMENT '用户姓名',
  `user_pin_type` tinyint(4) NOT NULL COMMENT '用户pin类型(1:erp账号；2:jd账号；3:其他账号)',
  `phone` varchar(64) DEFAULT NULL COMMENT '手机号',
  `group_code` varchar(64) DEFAULT NULL COMMENT '组织id',
  `group_type` tinyint(2) DEFAULT NULL COMMENT '类别：1：bu-业务部门；2：ka-合作机构;3:超级管理员组',
  `description` varchar(255) DEFAULT NULL COMMENT '用户描述',
  `last_login_time` datetime DEFAULT NULL COMMENT '最后一次登录时间',
  `user_status` tinyint(2) DEFAULT NULL COMMENT '激活状态1.激活，0冻结',
  `status` tinyint(2) NOT NULL COMMENT '状态1.可用，0删除',
  `created` datetime DEFAULT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `group_name` varchar(64) DEFAULT NULL COMMENT '组织名称',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `active_time` datetime DEFAULT NULL COMMENT '活跃时间',
  `phone_encrypt` varchar(128) DEFAULT NULL COMMENT '手机号加密字段',
  `phone_index` varchar(128) DEFAULT NULL COMMENT '手机号索引字段',
  `department` varchar(255) DEFAULT NULL COMMENT 'erp 员工部门',
  PRIMARY KEY (`id`),
  KEY `idx_app_group` (`app_id`, `group_code`) USING BTREE,
  KEY `idx_user_pin_type_app` (`user_pin`, `user_pin_type`, `app_id`) USING BTREE,
  KEY `idx_user_id_app_id` (`user_id`, `app_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 5055 DEFAULT CHARSET = utf8 COMMENT = '应用用户表'
```


app_info -- 应用表

```SQL
CREATE TABLE `app_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键id',
  `app_id` bigint(20) NOT NULL COMMENT '系统ID',
  `app_name_en` varchar(50) NOT NULL COMMENT '系统英文名称',
  `app_name_cn` varchar(50) NOT NULL COMMENT '系统中文名称',
  `description` varchar(255) DEFAULT NULL COMMENT '应用描述',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `extend_info` varchar(255) DEFAULT NULL COMMENT '扩展字段',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_idx_app_id` (`app_id`) USING BTREE COMMENT 'appId唯一索引'
) ENGINE = InnoDB AUTO_INCREMENT = 66 DEFAULT CHARSET = utf8 COMMENT = '应用信息'
```


app_user_info -- 应用-用户关系表
```SQL
CREATE TABLE `app_user_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `app_id` bigint(20) NOT NULL COMMENT 'appId',
  `erp` varchar(50) NOT NULL COMMENT 'erp',
  `status` tinyint(4) NOT NULL COMMENT '状态，1.可用，0.不可用',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `user_id` bigint(20) DEFAULT NULL COMMENT '用户id',
  PRIMARY KEY (`id`)
) ENGINE = InnoDB AUTO_INCREMENT = 520 DEFAULT CHARSET = utf8 COMMENT = '应用-用户关系表'
```


user_info

```SQL
CREATE TABLE `user_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `user_id` bigint(20) NOT NULL COMMENT '用户id',
  `user_pin` varchar(50) NOT NULL COMMENT '用户pin',
  `user_name` varchar(50) NOT NULL COMMENT '用户名（中文或英文）',
  `user_pin_type` tinyint(4) NOT NULL COMMENT '用户pin类型(1:erp账号；2:jd账号；3:其他账号)',
  `description` varchar(255) DEFAULT NULL COMMENT '用户描述',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uniq_index` (`user_pin`, `user_pin_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 3935 DEFAULT CHARSET = utf8 COMMENT = '用户信息表'
```


user_role_info

```SQL
CREATE TABLE `user_role_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `user_id` bigint(20) DEFAULT NULL COMMENT '用户id',
  `role_id` bigint(20) NOT NULL COMMENT '角色id',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `relation_id` varchar(32) DEFAULT NULL COMMENT '关联id',
  `user_type` tinyint(4) NOT NULL COMMENT '用户类型 1 人 2 部门 3 用户组',
  `app_id` bigint(20) DEFAULT NULL COMMENT '应用id',
  `main_operator` int(1) DEFAULT '0' COMMENT '主要人员标签 1 是 0 否',
  PRIMARY KEY (`id`),
  KEY `idx_user_id_role_id` (`user_id`, `role_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 36911 DEFAULT CHARSET = utf8 COMMENT = '用户-角色关系表'
```

white_app
white_list
white_list_type

"{\"centerId\":910769955025794,\"projectId\":\"910769954788226\",\"doctorPin\":\"1ord\"}"



auth_info

```SQL
CREATE TABLE `auth_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `auth_id` bigint(20) NOT NULL COMMENT '权限id',
  `auth_type` tinyint(4) NOT NULL COMMENT '权限类型：1.菜单项，2.页面元素，3.URL',
  `auth_name` varchar(200) DEFAULT NULL COMMENT '应用名称',
  `auth_parent_id` bigint(20) DEFAULT NULL COMMENT '权限父id',
  `filter_url` varchar(1000) DEFAULT NULL COMMENT '权限url',
  `icon_url` varchar(1000) DEFAULT NULL COMMENT '图标地址',
  `need_check` tinyint(4) DEFAULT '0' COMMENT '0 表示不验证 1表示验证',
  `filter_urls` varchar(1000) DEFAULT NULL COMMENT '菜单需要绑定的url',
  `app_id` bigint(20) NOT NULL COMMENT '系统id',
  `description` varchar(255) DEFAULT NULL COMMENT '权限描述',
  `creator` varchar(255) DEFAULT '' COMMENT '修改人PIN',
  `is_hide_menu` tinyint(1) DEFAULT NULL COMMENT '是否是隐藏菜单 null 或0-不是 1-是',
  `item_code` varchar(300) DEFAULT NULL COMMENT '页面元素编码',
  `item_type` tinyint(4) DEFAULT NULL COMMENT '页面元素类型：1：按钮；2：表格列；3：查询条件',
  `item_table_code` varchar(300) DEFAULT NULL COMMENT '表格code',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除，-1：未启用',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `resource_code` varchar(255) DEFAULT NULL COMMENT '资源码',
  `sensitive_tag` tinyint(1) DEFAULT NULL COMMENT '敏感标签',
  `resource_type` tinyint(1) DEFAULT NULL COMMENT '资源码类型',
  `order_num` int(11) DEFAULT NULL COMMENT '排序',
  `layout` tinyint(4) DEFAULT '1' COMMENT '页面布局，1 左右 2 上下',
  PRIMARY KEY (`id`),
  KEY `idx_auth_id` (`auth_id`) USING BTREE,
  KEY `idx_app_id_auth_type` (`app_id`, `auth_type`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 56981 DEFAULT CHARSET = utf8 COMMENT = '权限信息表'
```

data_resource
```SQL
CREATE TABLE `data_resource` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `resource_id` bigint(20) DEFAULT NULL COMMENT '数据资源id',
  `resource_type` varchar(255) DEFAULT NULL COMMENT '资源类型',
  `resource_value` varchar(255) DEFAULT NULL COMMENT '资源值',
  `parent_id` bigint(20) DEFAULT NULL COMMENT '父级资源',
  `remark` varchar(255) DEFAULT NULL COMMENT '资源简介',
  `creator` varchar(255) DEFAULT NULL COMMENT '创建人',
  `app_id` bigint(20) DEFAULT NULL COMMENT '应用id',
  `status` int(1) DEFAULT NULL COMMENT '状态 1 可用 0 禁用',
  `created` datetime DEFAULT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `env_flag` int(1) DEFAULT NULL COMMENT '环境标识',
  `tenant_id` varchar(32) DEFAULT NULL COMMENT '租户id',
  PRIMARY KEY (`id`),
  KEY `idx_resource_id` (`resource_id`) USING BTREE,
  KEY `idx_resource_type_value` (`resource_type`, `resource_value`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 89 DEFAULT CHARSET = utf8mb4 COMMENT = '数据资源表'
```

group_info

```sql
CREATE TABLE `group_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `group_type` tinyint(2) DEFAULT NULL COMMENT '类别：1：bu-业务部门；2：ka-合作机构',
  `app_id` bigint(20) NOT NULL COMMENT 'appId',
  `group_name` varchar(64) NOT NULL COMMENT '机构名称',
  `group_code` varchar(64) DEFAULT NULL COMMENT '机构编码',
  `parent_group_code` varchar(64) DEFAULT NULL COMMENT '父级机构code',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `contacts` varchar(64) DEFAULT NULL COMMENT '联系人',
  `phone` varchar(64) DEFAULT NULL COMMENT '联系人电话',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `scope` tinyint(4) DEFAULT NULL COMMENT '公共/所属',
  `level` tinyint(255) DEFAULT NULL COMMENT '级别',
  `description` varchar(512) DEFAULT NULL COMMENT '描述',
  `type_code` varchar(64) DEFAULT NULL COMMENT '机构编码',
  `env_flag` int(1) DEFAULT NULL COMMENT '环境标识 1 线上 2 预发',
  PRIMARY KEY (`id`),
  KEY `idx_group_code_app_id` (`group_code`, `app_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 6138 DEFAULT CHARSET = utf8 COMMENT = '组织机构表'

```


group_role_info
```SQL
CREATE TABLE `group_role_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键',
  `group_id` bigint(20) DEFAULT NULL COMMENT '组织机构id',
  `role_id` bigint(20) DEFAULT NULL COMMENT '角色id',
  `status` tinyint(4) DEFAULT NULL COMMENT '状态',
  `created` datetime DEFAULT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `creator` varchar(64) DEFAULT NULL COMMENT '创建人',
  `update_user` varchar(64) DEFAULT NULL COMMENT '修改人',
  PRIMARY KEY (`id`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8 COMMENT = '组织部门角色关系表'

```
group_type_info
```SQL
CREATE TABLE `group_type_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `app_id` bigint(20) DEFAULT NULL COMMENT '应用id',
  `type_name` varchar(128) DEFAULT NULL COMMENT '类别名称',
  `level` tinyint(4) DEFAULT NULL COMMENT '级别',
  `status` tinyint(4) DEFAULT NULL COMMENT '状态',
  `created` datetime DEFAULT NULL COMMENT '创建日期',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `type_code` varchar(64) DEFAULT NULL COMMENT '机构编码',
  PRIMARY KEY (`id`)
) ENGINE = InnoDB AUTO_INCREMENT = 66 DEFAULT CHARSET = utf8 COMMENT = '组织机构类型表'
```
menu_url_mapping
```sql
CREATE TABLE `menu_url_mapping` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '主键id',
  `app_id` bigint(20) NOT NULL COMMENT '系统ID',
  `menu_auth_id` bigint(20) NOT NULL COMMENT '菜单权限id',
  `filter_url` varchar(255) NOT NULL COMMENT '权限URL',
  `url_auth_id` bigint(20) NOT NULL COMMENT 'URL权限id',
  `creator` varchar(255) DEFAULT '' COMMENT '修改人PIN',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `created` timestamp NULL DEFAULT NULL COMMENT '创建时间',
  `modified` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  PRIMARY KEY (`id`)
) ENGINE = InnoDB AUTO_INCREMENT = 1772 DEFAULT CHARSET = utf8 COMMENT = '菜单url关系表'
```

new_white_key_scene_mapping
new_white_key_type
new_white_list_info
new_white_list_version
operation_log
role_auth_info
role_info

```SQL
CREATE TABLE `role_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',
  `role_id` bigint(20) NOT NULL COMMENT '角色id',
  `role_name` varchar(50) NOT NULL COMMENT '角色名称',
  `type` tinyint(2) DEFAULT NULL COMMENT '角色类型：1:预设；2：自建',
  `app_id` bigint(20) NOT NULL COMMENT 'appId',
  `description` varchar(255) DEFAULT NULL COMMENT '角色描述',
  `group_code` varchar(64) DEFAULT NULL COMMENT '机构编码',
  `group_name` varchar(64) DEFAULT NULL COMMENT '机构名称',
  `group_type` tinyint(4) DEFAULT NULL COMMENT '类别：1：bu-业务部门；2：ka-合作机构；3:超级管理员组',
  `status` tinyint(4) NOT NULL COMMENT '状态1.可用，0删除',
  `create_user_pin` varchar(64) DEFAULT NULL COMMENT '创建人',
  `created` datetime NOT NULL COMMENT '创建时间',
  `modified` datetime DEFAULT NULL COMMENT '修改时间',
  `tenant_id` bigint(20) DEFAULT NULL COMMENT '租户id',
  `role_code` varchar(255) DEFAULT NULL COMMENT '特定角色编码',
  `auth_type` int(1) DEFAULT '1' COMMENT '权限类型 1 页面 2 数据',
  `extend_info` varchar(255) DEFAULT NULL COMMENT '扩展信息',
  PRIMARY KEY (`id`),
  KEY `idx_role_id_app_id` (`role_id`, `app_id`) USING BTREE,
  KEY `idx_group_code` (`group_code`, `app_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 824 DEFAULT CHARSET = utf8 COMMENT = '角色信息表'
```

sensitive_field_detect_log
tenant_info
tenant_user_info
user_group_info
user_group_relation