---
title: 6-1
date: 2022-06-1 09:59:35
permalink: /pages/c3ff57/
categories:
  - 工作日志
  - 2022年
  - 6月
tags:
  - 
---
## 今日工作内容
1. RWD代码评审
2. 数据权限隔离技术方案评审


创建分中心并邀请中心管理员-谁可以此操作
删除中心管理员
查询中心管理员列表
邀请项目成员
删除中心项目成员
查询项目成员列表-分页
查询项目成员列表-全部
查询当前项目下医生详情


谁可以进行哪些操作可分解为：
当前登录人-找到其角色（角色列表）-每个角色可有的操作

每个角色需要的数据权限

项目成员中中心模式需要同步项目表内容。




1-先不考虑前端交互




3. 如何写好代码？-代码整洁之道，计划一个月读完。


manager(1L, "PI"),
    writer(2L, "录入员"),
    monitor(3L, "监察员"),
    dataManager(4L, "数据管理员"),
    normalUser(5L, "普通成员");


    mainCenterManager(1, "主中心管理员"),
    subCenterManager(2, "分中心管理员"),
    writer(3, "录入员"),
    dataManager(4, "数据管理员"),
    normalUser(5, "普通成员");



### 数据权限思考：

某个数据是否可以被一个人查看，一般来说是能根据一个简单的规则来进行限制的

1. 数据来源是谁，谁就能查看
2. 领导可以查看下属能看到的数据


前提：存在一个完整的组织架构树。
注意：组织架构树是职位的关联，比如一家销售公司，可能的组织架构树如下:
                                总经理
          华北区经理                              华东区经理
      北京销售经理  河北销售经理                上海经理     浙江经理
    北京普通销售人员 河北普通销售人员           上海普通销售人员 浙江普通销售人员

每个组织架构节点都可以关联多个用户；对应的，每个用户只能有一个职位。（假设某个用户担任了多个职位，如何处理？答：只需要加一张用户和组织架构节点的关联表即可）

#### 如何处理领导可以查看下属能看到的数据呢？

方案一：以订单为例，记录当前订单的创建人。
Q1：是否需要存当前订单对应的各级组织架构节点的负责人
答：无必要，因为可以根据人找到他所属的职位，根据职位找到组织机构架构树。

Q2：是否需要预存所有的当前订单所属的组织架构节点？
答：需要，而且只需要存具体的职位。但是这样存在一个问题，比如A Leader下有 B,C两个人，D Leader下有 E、F两个人，A和D同样都是大区经理职位，但是管控的人员是不一样的。

Q3：根据Q3引申出来的，组织架构一定是人与人直接关联！每个人有有自己的职位(当然，可能担任多个职位)。

Q4：查询数据时，具体流程是怎样的？
答：先获取当前登录人账号标识，根据组织机构找到所有的下属，然后找到该职位下的所有下属的账号标识，拼接到SQL或者ES中，进行查询。这样可能会存在另外一个问题：假设一个Leader下面
有 10000 个人，那么需要把这一万个人都拼到SQL中？又或者，当前登录人的职位较高，下属人员也会非常多，那么需要拼接的人员也会非常多。如何处理？答：当人员数据量非常大时，最好对
每个订单中各级组织机构节点的负责人带到订单中。这样可根据当前登录人账号标识和当前职位直接查询。

Q5：如果采用在表上加字段，如果该表的数据量特别的大，如何处理？
答：没有好的办法，想办法刷到ES中。

Q6：如何一个组织架构特别的大，那么产生的数据必然也非常多，那么采用刷数据的话，速度就会非常的慢。而且当某个职位的换了一个新的Leader,或者医生更换了科室和机构，那么这些历史数据如何处理？
答：医生变更了科室或机构后，要么同步到业务表中，要么历史数据就是历史数据，不同步，也就看不了。不同步的好处是:记录了当前该医生接诊时所属的科室快照，该数据是真实且准确的；坏处是无法根据医生新的科室去查询历史数据。运营张三运营科室A，比如医生 X 原来是科室A，现在换成了科室 B，那么张三便不负责运营医生 X 了。也就说，如果有张三和李四分别运营科室 A 和 B，那么张三能查到医生 X 以前的数据，李四能查到医生 X 现在的数据。当前某运营 运营的某科室的医生中，可能存在某些医生的订单数据是不完整的。某些运营负责的科室，可能包含一些医生的历史数据。如果同步的话，好处是：负责该科室的运营，可以明确的知道，当前运营科室的包含的医生的所有数据都是全的。坏处是：会丢失当前接诊时的真实科室。个人认为：历史数据不可修改，这样利大于弊。

Q7：假设某个Leader 轮换到了别的部门（领导不产出订单），那么现有的根据组织架构做数据权限隔离的方案还可行吗?
答：可行，因为每次查询时根据组织架构树找到下面所有人的数据，然后再根据具体账号标识查询。

Q8：假设某个普通销售 更换了部门，那么现有架构还能满足吗？
答：正常理解，如果张三从 A 
