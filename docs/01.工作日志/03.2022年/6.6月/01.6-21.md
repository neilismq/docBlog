---
title: 6-21
date: 2022-06-21 09:59:35
permalink: /pages/c3ff57/
categories:
  - 工作日志
  - 2022年
  - 6月
tags:
  - 
---
## 今日工作内容
- CPS bug修复上线
- 非医二期药师屏蔽OTC类目开发，商品搜索增加开发和联调
- 关注医生两个需求跟进
- OSS改造梳理
  - 内网上传和使用，全部采用 .local 后缀
  - 外网使用需要换成 https 协议链接
  - 历史数据需要将 http 头换成 https，可继续使用

商品推荐bug修复:
1、定投抽取医生特征时，转换DTO时，调用 Math.toIntExact 转换类型时，如果参数为空会报空指针。
2、家医商品搜索和商品收藏中显示的火苗不一致，原因是商品因查询CPS商品时，没有将联盟ID传入。
3、查询类目树时，对西药师职业显示处方药，其他职业屏蔽处方药，缺少判空处理，导致空指针。

代码优化：
1、查询CPS优惠券时没有判空处理，部分商品没有优惠券时会报空指针，但不影响商品显示。
2、定投修改活动状态接口，当定投的医生数据量较大时，同步调用会超时，现改为了异步调用。
3、定投预投放增加了对excel空行、空格的过滤，如不过滤，在确认投放接口入库时会报错。

以上问题已全部修改，并测试验证通过。

### 商品搜索 
旧接口参数：
[
  {
    "accountPin": "jd_731212a8977ce",
    "brandCode": "",
    "carefullyChosen": 0,
    "doctorId": 300611958003,
    "hotProduct": 0,
    "index": 1,
    "keyWord": "宠灵本草营养",
    "offset": 0,
    "page": 1,
    "pageSize": 10,
    "scene": 1,
    "sort": "asc",
    "sortName": "",
    "startRow": 0,
    "tenantId": "PET1000"
  },
  {
    "extraParas": "java.util.Map<java.lang.String, java.lang.Object>",
    "appToken": "bOE3Y",
    "clientIp": "wYGr",
    "appCode": "A86zJ"
  }
]


新接口：
{
    "accountPin": "jd_731212a8977ce",
    "brandCode": "",
    "carefullyChosen": 0,
    "doctorId": 300611958003,
    "hotProduct": 0,
    "index": 1,
    "keyWord": "宠灵本草营养",
    "offset": 0,
    "page": 1,
    "pageSize": 10,
    "scene": 2,
    "sort": "asc",
    "sortName": "",
    "startRow": 0,
    "tenantType": "PET1000"
  }










