---
title: 8-26
date: 2022-08-26 09:59:35
permalink: /pages/c3ff57/
categories: nhp_diag_info_sharding
  - 工作日志
  - 2022年
  - 8月
tags:
  - 
---

## 
1. 搜索商品接口重构
当一个人不传角色时，主动查医生角色时会存在无法判断身份情况。

老推荐接口逻辑
- 查询医生，com.jdh.nethp.doctor.base.client.service.doctor.DoctorInfoSearchExportClient#queryDoctorInfoByPin
- 查询医助或者管家，com.jd.newnethp.diag.export.doctor.workbench.AssistantIndexExport#getDoctorAssistantBaseInfo

新推荐接口中：
- 查询管家或者医助，com.jd.nethp.doctor.diag.doctorpatient.export.doctorinfo.DoctorInfoClient#getDoctorAssistantBaseInfo
- 查询医生，com.jdh.nethp.doctor.base.client.service.doctor.DoctorInfoSearchExportClient#queryDoctorInfoByPin

新搜索接口中：
- 查询管家或者医助，com.jd.nethp.doctor.diag.doctorpatient.export.doctorinfo.DoctorInfoClient#getDoctorAssistantBaseInfo

1、一个是医生集团管理平台导出机构账单时，这个机构数据量太大(一个账期60W)，导致机器内存溢出，昨天已重启机器。今天和业务同步了，先不要导这个机构的数据。后续修复方案为采用EasyExcel文件缓存方式去写，计划下周二上线。

2、商详订单结算时需要来CPS系统查询结算价，现在查询入参为sku或类目，但同一个sku或者类目可能会重复配置，导致查询该订单的结算价格查不到或者不准确。商详订单结束时间为30分钟，之前和业务同步过这个问题，要求在删除商详配置之前，至少需要先暂停半个小时。但是业务侧有时候将生效的配置直接删除了。这块计划改用可以唯一确定一个配置的标识去查，下周开始开发。



[
  {
    "diagResult": "3fBH0",
    "disease": "Ildpt",
    "acceptAppId": "jd.dyf",
    "accountName": "Ylxzr",
    "accountType": 7,
    "acceptPin": "Oh46U",
    "businessId": "7X0eo",
    "recommendClientSku": {
      "skuName": "5gFo",
      "catid": 85,
      "venderId": 98,
      "skuPrice": "vLnMU",
      "skuPic": "5CAO",
      "cid2": 6,
      "cid1": 68,
      "skuId": 85
    },
    "scene": 53,
    "accountId": 145,
    "clientType": 9,
    "accountPin": "NALtB",
    "businessLine": 43,
    "tenantId": "JMG15",
    "acceptBizRoles": [
      "9iEfm"
    ],
    "recommendSkuList": "java.util.List<com.jd.newnethp.cps.center.client.dto.recommend.RecommendClientSku>",
    "acceptPins": [
      "9iEfm"
    ]
  }
]













